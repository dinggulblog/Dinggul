"use strict";(self["webpackChunkDINGGUL"]=self["webpackChunkDINGGUL"]||[]).push([[913],{9432:function(e,t,s){s.d(t,{Z:function(){return c}});var o=s(6252),l=s(3577);const a={class:"toggle"};var r={__name:"Toggle",props:{isPublic:{type:Boolean}},emits:["update"],setup(e,{emit:t}){return(s,r)=>{const i=(0,o.up)("Ico");return(0,o.wg)(),(0,o.iD)("div",a,[(0,o.Wm)(i,{class:"ico_toggle",svg:e.isPublic?"toggle":"toggle-fill",size:"xl",color:e.isPublic?"var(--disable)":"primary",onClick:r[0]||(r[0]=s=>t("update",!e.isPublic))},null,8,["svg","color"]),(0,o._)("span",{style:(0,l.j5)([e.isPublic?{color:"var(--text3)"}:{color:"var(--primary)"}])},(0,l.zw)(e.isPublic?"공개":"비밀"),5)])}}},i=s(3744);const n=(0,i.Z)(r,[["__scopeId","data-v-38d0afd3"]]);var c=n},7007:function(e,t,s){s.r(t),s.d(t,{default:function(){return we}});s(7658);var o=s(6252),l=s(2262),a=s(3577),r=s(3907),i=s(4254),n=s(9963),c=s(4247),u=s(9432);const d=["disabled","placeholder"],m={class:"wrap_btns"},p={class:"wrap_toggle"},v={class:"wrap_submit"},_={class:"submit"};var w={__name:"CommentEditor",props:{id:{type:String,default:"comment"},postId:{type:String,reqired:!0},isOwner:{type:Boolean,default:!1},placeholderText:{type:String,default:"댓글을 작성해보세요."}},emits:["closeEditor"],setup(e,{emit:t}){const s=e,{state:i,dispatch:w,commit:g}=(0,r.oR)(),h=(0,l.iH)(null),f=(0,o.f3)("ACCOUNT_EL"),k=(0,o.f3)("TOAST_EL"),y=(0,o.Fl)({get:()=>i.comment[s.id]._id}),S=(0,o.Fl)({get:()=>i.comment[s.id].isPublic,set:e=>g("comment/SET_IS_PUBLIC",{id:s.id,isPublic:e})}),b=(0,o.Fl)({get:()=>i.comment[s.id].content,set:e=>g("comment/SET_CONTENT",{id:s.id,content:e})}),I=e=>{S.value=e},U=async()=>{const{success:e,error:o}=await w("comment/createComment",{parentId:"comment"!==s.id?s.id:void 0,postId:s.postId,content:b.value,isPublic:S.value});if(!e)return k.value.open("error",o);t("closeEditor"),h.value.style.height=""},C=async()=>{const{success:e,error:o}=await w("comment/updateComment",{commentId:y.value,postId:s.postId,content:b.value,isPublic:S.value});if(!e)return k.value.open("error",o);t("closeEditor"),h.value.style.height=""};return(0,o.bv)((()=>{"comment"!==s.id&&h.value.focus()})),(t,s)=>{const r=(0,o.up)("Button");return(0,o.wg)(),(0,o.iD)("div",{class:"commentEditor",onMousedown:s[4]||(s[4]=e=>!t.$store.state.auth.user&&(0,l.SU)(f).open("login"))},[(0,o.wy)((0,o._)("textarea",{ref_key:"CONTENT_EL",ref:h,rows:"1","onUpdate:modelValue":s[0]||(s[0]=e=>(0,l.dq)(b)?b.value=e:null),disabled:!t.$store.state.auth.user,placeholder:t.$store.state.auth.user?e.placeholderText:"로그인 후 댓글을 작성해보세요.",onBlur:s[1]||(s[1]=s=>t.$store.state.auth.user?e.placeholderText:"로그인 후 댓글을 작성해보세요."),onInput:s[2]||(s[2]=(...e)=>(0,l.SU)(c.e2)&&(0,l.SU)(c.e2)(...e))},null,40,d),[[n.nr,(0,l.SU)(b)]]),(0,o._)("div",m,[(0,o._)("div",p,[(0,o.Wm)(u.Z,{isPublic:(0,l.SU)(S),onUpdate:I},null,8,["isPublic"])]),(0,o._)("div",v,[(0,o._)("div",_,[(0,o.Wm)(r,{class:"btn_submit",shape:"fill-round",theme:"primary",onClick:s[3]||(s[3]=e=>(0,l.SU)(y)?C():U())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)((0,l.SU)(y)?"댓글 수정":"댓글 작성"),1)])),_:1})])])])],32)}}},g=s(3744);const h=(0,g.Z)(w,[["__scopeId","data-v-5364be50"]]);var f=h,k=s(6603),y=s(3620);const S={class:"info"};function b(e,t){return(0,o.wg)(),(0,o.iD)("div",S,[(0,o._)("ul",null,[(0,o.WI)(e.$slots,"createdAt",{},void 0,!0),(0,o.WI)(e.$slots,"category",{},void 0,!0)])])}const I={},U=(0,g.Z)(I,[["render",b],["__scopeId","data-v-74ca9d0e"]]);var C=U;const E=e=>((0,o.dD)("data-v-54fd9ef5"),e=e(),(0,o.Cn)(),e),T={class:"comment_item"},A={class:"wrap_item"},O={class:"wrap_header"},L={class:"wrap_left"},D={class:"createdAt"},P={key:0,class:"wrap_reply_btn"},x={key:0,class:"wrap_right"},z={class:"content"},W={key:0,class:"receiver"},q={key:2},N=E((()=>(0,o._)("i",null,"*** 삭제된 댓글입니다. ***",-1))),H=[N],$={key:3},B=E((()=>(0,o._)("strong",null,"비밀",-1))),M={key:4},j={key:0,class:"comment_childItem"};var K={__name:"Comment",props:{postId:{type:String,required:!0,default:""},comment:{type:Object,required:!0,default:()=>({})},isOwner:{type:Boolean,default:!1},isAuthor:{type:Boolean,default:!1}},setup(e){const t=e,{getters:s,dispatch:i,commit:n}=(0,r.oR)(),c=(0,o.f3)("DIALOG_EL"),u=(0,o.f3)("TOAST_EL"),{comment:d,postId:m,isOwner:p}=(0,l.BK)(t),v=(0,l.iH)(!1),_=(0,l.iH)(!1),w=(0,o.Fl)((()=>s["comment/getParentComment"](d.value?.parentComment))),g=(e=!1)=>{n("comment/SET_COMMENT",{update:e,comment:d.value}),v.value=!0},h=()=>{v.value=!1},S=()=>{_.value=!_.value},b=async()=>{try{await navigator.clipboard.writeText(d.value.content),u.value.open("success","댓글 내용이 복사되었습니다")}catch{u.value.open("error","댓글 내용 복사에 실패하였습니다.")}},I=async()=>{const e=await c.value.show({title:"댓글 삭제",message:"해당 댓글을 삭제하시겠습니까?\n한번 삭제된 댓글은 되돌릴 수 없습니다."});if(!e)return;const{success:t,error:s}=await i("comment/deleteComment",{commentId:d.value._id,postId:m.value,isOwner:p.value});t?u.value.open("success","댓글이 삭제되었습니다."):u.value.open("error",s)};return(t,s)=>{const r=(0,o.up)("Button"),i=(0,o.up)("Kebab"),n=(0,o.up)("Ico");return(0,o.wg)(),(0,o.iD)("li",T,[(0,o._)("div",A,[(0,o._)("div",O,[(0,o._)("div",L,[(0,o.Wm)(y.Z,{profile:(0,l.SU)(d).commenter},null,8,["profile"]),(0,o.Wm)(C,null,{createdAt:(0,o.w5)((()=>[(0,o._)("li",null,[(0,o._)("span",D,(0,a.zw)((0,l.SU)(k.h)((0,l.SU)(d).createdAt)),1)])])),_:1}),(0,l.SU)(d).isActive&&t.$store.state.auth.user?((0,o.wg)(),(0,o.iD)("div",P,[(0,o.Wm)(r,{class:"btn_reply",theme:"primary",onClick:s[0]||(s[0]=e=>v.value?h():g(!1)),"aria-label":"create reply"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(v.value?"에디터 닫기":"답글 작성"),1)])),_:1})])):(0,o.kq)("",!0)]),(0,l.SU)(d).isActive?((0,o.wg)(),(0,o.iD)("div",x,[(0,o.Wm)(r,{class:"btn_dropbox",size:"sm",svg:"more",onClick:s[1]||(s[1]=e=>t.$refs.ACTION_SLOT_EL.onToggle()),"aria-label":"option"}),(0,o.Wm)(i,{ref:"ACTION_SLOT_EL",dropboxItems:(0,l.SU)(p)?{"댓글 복사":b,"댓글 수정":()=>g(!0),"댓글 삭제":I}:{"댓글 복사":b}},null,8,["dropboxItems"])])):(0,o.kq)("",!0)]),(0,o._)("div",z,[(0,o._)("p",null,[(0,l.SU)(w)?((0,o.wg)(),(0,o.iD)("span",W,"@ "+(0,a.zw)((0,l.SU)(w)?.commenter?.nickname),1)):(0,o.kq)("",!0),(0,l.SU)(d).isPublic?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(n,{key:1,class:"lock_ico",size:"sm",svg:"lock",color:"var(--text2)"},null,8,["color"])),(0,l.SU)(d).isActive?(0,l.SU)(d).isPublic||e.isAuthor||(0,l.SU)(p)?((0,o.wg)(),(0,o.iD)("span",M,(0,a.zw)((0,l.SU)(d).content),1)):((0,o.wg)(),(0,o.iD)("span",$,[B,(0,o.Uk)(" 댓글입니다. 게시물 작성자와 관리자만 볼 수 있어요.")])):((0,o.wg)(),(0,o.iD)("span",q,H))]),(0,l.SU)(d).childCommentCount?((0,o.wg)(),(0,o.j4)(r,{key:0,class:"btn_childComment_toggle",svg:_.value?"arrow-up":"arrow-down",size:"sm",theme:"primary",onClick:S,"aria-label":"open reply"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)("답글 "+(0,l.SU)(d).childCommentCount+"개"),1)])),_:1},8,["svg"])):(0,o.kq)("",!0)]),v.value?((0,o.wg)(),(0,o.j4)(f,{key:0,id:(0,l.SU)(d)._id,postId:(0,l.SU)(m),onCloseEditor:h},null,8,["id","postId"])):(0,o.kq)("",!0)]),(0,l.SU)(d).childComments&&_.value?((0,o.wg)(),(0,o.iD)("ul",j,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,l.SU)(d).childComments,(s=>((0,o.wg)(),(0,o.j4)(F,{key:s._id,postId:(0,l.SU)(m),comment:s,isOwner:s.commenter._id===t.$store.state.auth.user?._id,isAuthor:e.isAuthor},null,8,["postId","comment","isOwner","isAuthor"])))),128))])):(0,o.kq)("",!0)])}}};const Z=(0,g.Z)(K,[["__scopeId","data-v-54fd9ef5"]]);var F=Z;const Y={key:0,class:"post"},G={class:"wrap_header"},V={class:"wrap_left"},R={class:"wrap_title"},Q={class:"title"},J={key:0,class:"ico_lock"},X={class:"wrap_info"},ee={class:"createdAt"},te={class:"category"},se={class:"wrap_right"},oe={class:"wrap_like"},le={class:"liked_count"},ae={class:"wrap_author"},re={class:"wrap_link"},ie={key:0},ne={key:1},ce={class:"wrap_toc"},ue={class:"toc"},de=["href"],me={class:"comment"},pe={class:"comment_items"};var ve={__name:"Post",props:{postId:{type:String,required:!0}},setup(e){const t=e,{state:s,dispatch:n,commit:c}=(0,r.oR)(),u=(0,o.f3)("DIALOG_EL"),d=(0,o.f3)("TOAST_EL"),m=(0,l.iH)(null),p=(0,l.iH)(null),v=(0,l.iH)(null),_=(0,l.iH)(null),w=(0,l.iH)(new Map),g=(0,l.iH)([]),h=(0,o.Fl)((()=>s.post.post)),S=(0,o.Fl)((()=>s.auth.user&&h.value.author?._id===s.auth.user._id)),b=async()=>{const e=await u.value.show({title:"게시물 삭제",message:"게시물을 삭제하시겠습니까?\n한번 삭제된 게시물은 되돌릴 수 없습니다."});if(e){const{success:e,error:t}=await n("post/deletePost");if(!e)return d.value.open("error",t)}},I=async()=>{const{success:e,error:t}=h.value.liked?await n("post/deleteLike"):await n("post/updateLike");e||d.value.open("error",t)},U=async()=>{try{await navigator.clipboard.writeText(window.location.href),d.value.open("success","클립보드에 게시물 링크가 복사되었습니다")}catch{d.value.open("error","링크 복사에 실패하였습니다.")}},E=(e,t)=>{e.map((e=>{if(e.isIntersecting)w.value.set(e.target.id,e),g.value=[...w.value.values()].filter((e=>e&&e.isIntersecting)),v.value.forEach((e=>e.classList.remove("on"))),g.value.length&&v.value.find((e=>e.getAttribute("class")===g.value[0].target.id)).classList.add("on");else{const t=g.value.findIndex((t=>t.target.id===e.target.id));-1!==t&&g.value.splice(t,1),w.value.set(e.target.id,e),v.value.forEach((e=>e.classList.remove("on"))),g.value.length&&v.value.find((e=>e.getAttribute("class")===g.value[0].target.id)).classList.add("on")}}))},T=new IntersectionObserver(E,{threshold:.5,rootMargin:"-114px 0px 0px 0px"}),A=async()=>{await(0,o.Y3)(),T.disconnect(),w.value.clear(),_.value=[],g.value=[];const e=m.value?.querySelectorAll("h1, h2, h3");e?.length&&e.forEach((t=>{document.getElementById("md-editor-v3-preview-wrapper").style.overflow="initial",t.style.scrollMarginTop="11.4rem",_.value=Array.from(e).map((e=>e)),w.value.set(t.getAttribute("id"),null),T.observe(t)}))};return(0,o.YP)(t,(async()=>{const{success:e,error:o}=await n("post/getPost",{postId:t.postId});if(!e)throw new Error(o);const{success:l,error:a}=await n("comment/getComments",{postId:t.postId});if(!l)throw new Error(a);document.title=h.value?.title,s.post.quickMove&&p.value&&(p.value.scrollIntoView({behavior:"smooth"}),c("post/SET_QUICKMOVE",!1))}),{immediate:!0}),(0,o.wF)((()=>{c("post/UNSET_POST"),c("comment/UNSET_COMMENTS")})),(0,o.Ah)((()=>{T.disconnect()})),(t,s)=>{const r=(0,o.up)("Ico"),n=(0,o.up)("Button"),c=(0,o.up)("Kebab"),u=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,l.SU)(h)?((0,o.wg)(),(0,o.iD)("div",Y,[(0,o._)("div",G,[(0,o._)("div",V,[(0,o._)("div",R,[(0,o._)("div",Q,[(0,o._)("h2",null,(0,a.zw)((0,l.SU)(h).title),1),(0,l.SU)(h).isPublic?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("span",J,[(0,o.Wm)(r,{svg:"lock",color:"var(--text2)"},null,8,["color"])]))])]),(0,o._)("div",X,[(0,o.Wm)(C,null,{createdAt:(0,o.w5)((()=>[(0,o._)("li",null,[(0,o._)("span",ee,(0,a.zw)((0,l.SU)(k.h)((0,l.SU)(h).createdAt)),1)])])),category:(0,o.w5)((()=>[(0,o._)("li",null,[(0,o._)("span",te,(0,a.zw)((0,l.SU)(h).category),1)])])),_:1})])]),(0,o._)("div",se,[(0,o.Wm)(n,{class:"btn_dropbox",size:"sm",svg:"more",onClick:s[0]||(s[0]=e=>t.$refs.KEBAB_EL.onToggle()),"aria-label":"option"}),(0,o.Wm)(c,{ref:"KEBAB_EL",dropboxItems:(0,l.SU)(S)?{"글 수정":()=>t.$router.push({name:"editor",query:{postId:t.$store.state.post.post._id}}),"글 삭제":b,"링크 복사":U}:{"링크 복사":U}},null,8,["dropboxItems"])])]),(0,o._)("div",{class:"content",ref_key:"CONTENT_EL",ref:m},[(0,o.Wm)((0,l.SU)(i.Z),{previewOnly:"",modelValue:(0,l.SU)(h).content,onOnHtmlChanged:A},null,8,["modelValue"])],512),(0,o._)("div",oe,[(0,o._)("div",le,[(0,o.Wm)(r,{class:"ico_like",svg:"like-fill",color:(0,l.SU)(h).liked?"var(--likeActive)":"var(--disable)",onClick:I},null,8,["color"]),(0,o._)("span",null,(0,a.zw)((0,l.SU)(h).likeCount),1)])]),(0,o._)("div",ae,[(0,o.Wm)(y.Z,{profile:(0,l.SU)(h).author},null,8,["profile"]),(0,l.SU)(h).author?((0,o.wg)(),(0,o.j4)(u,{key:0,to:{name:"profile",params:{nickname:(0,l.SU)(h).author.nickname}},class:"a_link"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 프로필 보러가기 ")])),_:1},8,["to"])):(0,o.kq)("",!0)]),(0,o._)("div",re,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,l.SU)(h).linkedPosts,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e?._id,class:"link"},["prev"===e.rel?((0,o.wg)(),(0,o.iD)("span",ie,"이전글")):((0,o.wg)(),(0,o.iD)("span",ne,"다음글")),(0,o.Wm)(n,{class:"btn_link",onClick:()=>t.$router.push({name:"post",params:{postId:e._id}})},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.title),1)])),_:2},1032,["onClick"])])))),128))]),((0,o.wg)(),(0,o.j4)(o.lR,{to:"#content"},[(0,o._)("div",ce,[(0,o._)("ul",ue,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(_.value,(e=>((0,o.wg)(),(0,o.iD)("li",{key:e},[(0,o._)("a",{href:"#"+e.getAttribute("id"),class:(0,a.C_)(e.getAttribute("id")),ref_for:!0,ref_key:"TOC_EL",ref:v,style:(0,a.j5)("H2"===e.tagName?{marginLeft:"0.8rem"}:"H3"===e.tagName?{marginLeft:"1.6rem"}:"")},(0,a.zw)(e.innerText),15,de)])))),128))])])]))])):(0,o.kq)("",!0),(0,o._)("div",me,[(0,o.Wm)(f,{postId:e.postId},null,8,["postId"]),(0,o._)("div",{class:"comments",ref_key:"COMMENTS_EL",ref:p},[(0,o._)("h2",null,"댓글 "+(0,a.zw)(t.$store.state.comment.commentCount)+"개",1),(0,o._)("ul",pe,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.$store.state.comment.comments,(s=>((0,o.wg)(),(0,o.j4)(F,{key:s._id,postId:e.postId,comment:s,isOwner:s.commenter._id===t.$store.state.auth.user?._id,isAuthor:(0,l.SU)(h).author._id===t.$store.state.auth.user?._id},null,8,["postId","comment","isOwner","isAuthor"])))),128))])],512)])],64)}}};const _e=(0,g.Z)(ve,[["__scopeId","data-v-8a622bf0"]]);var we=_e}}]);
//# sourceMappingURL=post.6d4b4743.js.map